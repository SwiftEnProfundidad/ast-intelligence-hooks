# Refactor Progress Tracker

Estado operativo activo del repositorio.

## Leyenda
- ‚úÖ Hecho
- üöß En construccion (maximo 1)
- ‚è≥ Pendiente
- ‚õî Bloqueado

## Estado actual
- ‚úÖ `HYG.T1` Inventario completo de markdowns, artefactos y carpetas hu√©rfanas.
- ‚úÖ `HYG.T2` Unificaci√≥n documental oficial creada: `docs/validation/detection-audit-baseline.md`.
- ‚úÖ `HYG.T3` Limpieza aplicada:
  - eliminados ciclos/reportes forenses obsoletos del root de `docs/`
  - eliminados artefactos forenses de `assets/readme/forensics-violations/*`
  - eliminada documentaci√≥n no oficial de ra√≠z (`CLAUDE.md`)
  - eliminadas carpetas hu√©rfanas vac√≠as (`apps/*`, `assets/readme/menu-option1-notification-proof/*`)
- ‚úÖ `HYG.T4` Verificaci√≥n final de higiene enterprise:
  - referencias rotas cr√≠ticas: `0`
  - compilaci√≥n TypeScript: `OK` (`npm run typecheck`)
  - inventario de `.md` normalizado y sin reportes/ciclos forenses en `docs/` root
- ‚úÖ `P-ADHOC-LINES-002` Extender extracci√≥n de l√≠neas AST al resto de familias heur√≠sticas (`process/security/browser/fs`) para minimizar anchors por fallback.
  - detectores `process/security/browser` con `find*Lines` y pruebas dedicadas
  - autolocalizaci√≥n de l√≠neas AST por convenci√≥n `has*/find*Lines`
  - inferencia para familia `fs` (`sync/promises/callbacks`) sin hardcode por regla
  - validaci√≥n: tests heur√≠sticos focales `OK` + `npm run typecheck` `OK`
- ‚úÖ `P-ADHOC-LINES-003` Verificar trazabilidad clicable end-to-end en men√∫/reportes usando `lines` de todas las familias AST.
  - salida de bloqueo en gate (`runPlatformGateOutput`) enriquecida con `severity + ruleId + message + file:line`
  - `exportLegacyAuditMarkdown` ahora incluye secciones markdown con rutas clicables `./path#Lline`
  - cobertura de tests para salida clicable y export markdown
  - validaci√≥n: tests focales `OK` + `npm run typecheck` `OK`
- ‚úÖ `P-ADHOC-LINES-004` Ejecutar smoke e2e de trazabilidad (`pre-write`, `pre-commit`, `pre-push`, men√∫ opci√≥n 1/8/9) y registrar evidencias finales.
  - tests runtime men√∫ para opci√≥n `9` (diagn√≥stico clicable) y opci√≥n `8` (export markdown clicable)
  - tests de salida gate (`runPlatformGateOutput`) con `lines` array/string/sin l√≠neas
  - validaci√≥n: suite focal `OK` (29 tests) + `npm run typecheck` `OK`
- ‚úÖ `P-ADHOC-LINES-005` Ejecutar auditor√≠a funcional completa y verificar visualmente trazabilidad clicable en salida real de hooks + men√∫.
  - hooks reales ejecutados con evidencia en:
    - `.audit_tmp/prewrite-functional.out`
    - `.audit_tmp/precommit-functional.out`
    - `.audit_tmp/prepush-functional.out`
  - validado `file:line` en bloqueos de hooks:
    - `pre-write`: `openspec/changes:1`, `.ai_evidence.json:1`, `.git/HEAD:1`
    - `pre-commit` / `pre-push`: `openspec/changes:1`
  - flujo men√∫ consumer validado en TTY real (`1 -> 8 -> 9 -> 10`) con evidencia en:
    - `.audit_tmp/menu-functional-tty.out`
    - export markdown: `.audit-reports/pumuki-legacy-audit.md`
  - comprobadas secciones clicables en markdown:
    - `## Clickable Top Files`
    - `## Clickable Findings` con enlaces `./path#Lline`
- ‚úÖ `P-ADHOC-LINES-006` Consolidar reporte final de recuperaci√≥n de detecci√≥n enterprise (resumen funcional + evidencias clave) para cierre operativo del ciclo.
  - reporte oficial creado en `docs/validation/enterprise-detection-recovery-closure.md`
  - incluye estado consolidado del gate, severidades, cobertura y evidencias de hooks/men√∫/export markdown
  - `docs/validation/README.md` actualizado para registrar el documento como referencia versionada
- ‚úÖ `P-ADHOC-LINES-007` Preparar cierre Git Flow end-to-end (commit at√≥mico, PR, merge y sincronizaci√≥n) sin p√©rdida de cambios.
  - rama de trabajo dedicada `feature/p-adhoc-lines-007-gitflow-closure`
  - validaci√≥n previa de calidad ejecutada (`tsx --test` focal + `npm run typecheck`)
  - lote consolidado para commit at√≥mico del ciclo de recuperaci√≥n
  - cierre previsto por PR con merge a `develop` y sincronizaci√≥n de ramas protegidas
- ‚úÖ `P-ADHOC-LINES-008` Ejecutar auditor√≠a full-repo post-cierre y emitir informe final de violaciones por severidad con rutas clicables.
  - auditor√≠a full-repo ejecutada en men√∫ consumer (`1`) con evidencia en `.audit_tmp/p-adhoc-lines-008-menu.out`
  - export markdown clicable ejecutado (`8`) en `.audit-reports/pumuki-legacy-audit.md`
  - informe final por severidad con rutas clicables generado en `.audit-reports/p-adhoc-lines-008-full-repo-audit.md`
  - resumen de severidad post-cierre: `CRITICAL 42`, `HIGH 37`, `MEDIUM 4`, `LOW 0`
- ‚úÖ `P-ADHOC-LINES-009` Publicar informe consolidado post-merge en `docs/validation` con:
  - resumen por severidad (`CRITICAL/HIGH/MEDIUM/LOW`)
  - top reglas y top ficheros con `file:line`
  - cobertura de reglas (`active/evaluated/unevaluated/ratio`)
  - informe publicado en `docs/validation/post-merge-detection-audit-report.md`
  - documento registrado en `docs/validation/README.md` como referencia versionada
- ‚úÖ `P-ADHOC-LINES-010` Verificar paridad/superaci√≥n respecto a baseline legacy en detecci√≥n:
  - comparar conteos y distribuci√≥n por severidad
  - documentar brechas de detecci√≥n por familia de reglas
  - dejar plan de correcci√≥n priorizado por impacto
  - comparativa reproducible generada en `.audit-reports/p-adhoc-lines-010-legacy-parity.md`
  - an√°lisis oficial publicado en `docs/validation/legacy-parity-gap-analysis.md`
  - resultado actual: superaci√≥n en `CRITICAL`, brecha pendiente en `HIGH` (`-4`) y `MEDIUM` (`-17`)
- ‚úÖ `P-ADHOC-LINES-011` Remediar brechas cr√≠ticas de detecci√≥n identificadas en la comparaci√≥n:
  - TDD aplicado en detectores TypeScript para:
    - `common.types.unknown_without_guard` (detecci√≥n por AST de `unknown` fuera de `Record<*, unknown>`)
    - `common.network.missing_error_handling` (detecci√≥n por nodo de red sin `try/catch` local ni cadena `.catch`)
  - trazabilidad corregida en heur√≠sticas multi-fichero para respetar `filePath` del finding al resolver `lines`
  - validaci√≥n t√©cnica ejecutada:
    - tests focales (`47/47` OK) en detectores/extracci√≥n/trazabilidad
    - compilaci√≥n TypeScript (`npx tsc --noEmit`) OK
    - smoke runtime hooks+men√∫ con evidencia en:
      - `.audit_tmp/p-adhoc-lines-011-prewrite.out`
      - `.audit_tmp/p-adhoc-lines-011-precommit.out`
      - `.audit_tmp/p-adhoc-lines-011-prepush.out`
      - `.audit_tmp/p-adhoc-lines-011-menu.out`
  - resultado funcional:
    - `common.types.unknown_without_guard` pasa de 4 a 59 hallazgos en evidencia full-repo
    - trazabilidad `file:line` deja de colapsar en una l√≠nea repetida global
    - men√∫ `1` refleja severidad y top violaciones con rutas clicables actualizadas

## Siguiente paso operativo
- üöß Ejecutar `P-ADHOC-LINES-014` para saneamiento CI post-merge en `main`.

## Backlog global restante
- ‚úÖ `P-ADHOC-LINES-012` Cierre final del ciclo enterprise:
  - ‚úÖ revalidaci√≥n integral ejecutada:
    - tests focales `48/48` en `.audit_tmp/p-adhoc-lines-012-tests.out`
    - `typecheck` `OK` en `.audit_tmp/p-adhoc-lines-012-typecheck.out`
    - smoke hooks+men√∫ en:
      - `.audit_tmp/p-adhoc-lines-012-prewrite.out`
      - `.audit_tmp/p-adhoc-lines-012-precommit.out`
      - `.audit_tmp/p-adhoc-lines-012-prepush.out`
      - `.audit_tmp/p-adhoc-lines-012-menu.out`
      - iteraci√≥n v2:
        - `.audit_tmp/p-adhoc-lines-012-prewrite-v2.out`
        - `.audit_tmp/p-adhoc-lines-012-precommit-v2.out`
        - `.audit_tmp/p-adhoc-lines-012-prepush-v2.out`
        - `.audit_tmp/p-adhoc-lines-012-menu-v2.out`
  - ‚úÖ documentaci√≥n oficial de revalidaci√≥n publicada:
    - `docs/validation/enterprise-detection-revalidation-cycle-012.md`
    - √≠ndice actualizado en `docs/validation/README.md`
  - ‚úÖ paridad legacy por severidad cerrada:
    - `CRITICAL 42 >= 9`, `HIGH 43 >= 41`, `MEDIUM 59 >= 21`, `LOW 0 = 0`
    - reporte: `.audit-reports/p-adhoc-lines-012-legacy-parity-v2.md`
  - ‚úÖ cierre Git Flow end-to-end completado:
    - PR `#360` (feature -> `develop`) merged
    - PR `#361` (`develop` -> `main`) merged (admin)
    - ramas locales y remotas sincronizadas con solo `develop` y `main`
- ‚úÖ `P-ADHOC-LINES-013` Verificaci√≥n post-merge de estabilidad:
  - estado post-merge de `PR #361` verificado (`MERGED`, commit `cedaf08f93d70ad7d820556f2574becf8ed03f6b`)
  - baseline de checks no verdes consolidado en:
    - `.audit_tmp/p-adhoc-lines-013-main-pr-checks.tsv`
    - `.audit_tmp/p-adhoc-lines-013-main-pr-checks-unique.tsv`
  - nota oficial de riesgo residual y plan de saneamiento publicada:
    - `docs/validation/post-merge-main-stability-note.md`
  - √≠ndice documental actualizado en `docs/validation/README.md`
- üöß `P-ADHOC-LINES-014` Saneamiento CI post-merge en `main`:
  - ‚úÖ baseline de fallos post-merge recopilado:
    - `.audit_tmp/p-adhoc-lines-013-main-pr-checks.tsv`
    - `.audit_tmp/p-adhoc-lines-013-main-pr-checks-unique.tsv`
    - `.audit_tmp/p-adhoc-lines-014-ci-failure-map.md`
  - ‚úÖ plan incremental por dominios documentado:
    - `docs/validation/ci-sanitization-plan-cycle-014.md`
  - ‚úÖ reproducidos checks fallidos y causas ra√≠z confirmadas (lote A):
    - `check-package-manifest`: crash por API legacy `npm-packlist` v10
    - `package-smoke`: m√≥dulo no incluido en paquete (`integrations/notifications/emitAuditSummaryNotification.ts`)
  - ‚úÖ correcci√≥n lote A implementada y validada localmente:
    - `scripts/check-package-manifest.ts`
    - `scripts/__tests__/check-package-manifest.test.ts`
    - `scripts/package-manifest-lib.ts`
    - `package.json` (`files`)
    - reproducci√≥n CI local completa en verde: `.audit_tmp/ci-repro-014/summary.tsv`
  - ‚úÖ lote A publicado en PR incremental:
    - `https://github.com/SwiftEnProfundidad/ast-intelligence-hooks/pull/363`
  - ‚è≥ validar checks remotos del lote A
    - bloqueo externo detectado: GitHub Actions no inicia jobs por billing lock de cuenta
    - documentaci√≥n de bloqueo:
      - `docs/validation/post-merge-main-stability-note.md`
      - `docs/validation/ci-sanitization-plan-cycle-014.md`
  - ‚è≥ objetivo de salida: checks cr√≠ticos en verde en `main` sin bypass admin
